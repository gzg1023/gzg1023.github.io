<!DOCTYPE html>
<html lang="zh" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="gzg1023" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
  <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
  
  
  
  <title>
    
      ã€åŸç†æ¢ç´¢ã€‘vue.js(2.x)æ¡†æ¶åº•å±‚åŸç†- å®ç°mini vueã€Œ01ã€ 
      
      
      |
    
     æ²½é»˜æ¸…å°˜çš„åšå®¢
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- ä»£ç å—é£æ ¼ -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">æ²½é»˜æ¸…å°˜çš„åšå®¢</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">ã€åŸç†æ¢ç´¢ã€‘vue.js(2.x)æ¡†æ¶åº•å±‚åŸç†- å®ç°mini vueã€Œ01ã€</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-11-14 00:10:05
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/%E5%89%8D%E7%AB%AF/" title="å‰ç«¯">
                    #å‰ç«¯
                  </a>
                </span>
                
                <span class="span--tag mr-8">
                  <a href="/tags/vue%E5%8E%9F%E7%90%86/" title="vueåŸç†">
                    #vueåŸç†
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <blockquote>
<p>å“åº”å¼æ€æƒ³ï¼Œå¯ä»¥ç†è§£ä¸ºè‡ªåŠ¨å›å¤æ¶ˆæ¯ï¼Œæˆ‘å‘é€æ¶ˆæ¯ç»™ä½ ï¼Œä½ ä¼šè¿”å›ç»™æˆ‘ç›¸åº”çš„å›å¤ã€‚vue é€šè¿‡å“åº”å¼è®¾è®¡è®©æ•°æ®å¾—åˆ°è‡ªåŠ¨çš„æ§åˆ¶ä¹Ÿå°±äº§ç”Ÿäº† MVVM çš„æ€æƒ³ï¼Œä»è€Œå®ç°æ•°æ®åŒå‘ç»‘å®šã€‚</p>
</blockquote>
<span id="more"></span>

<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å½“ä½ æŠŠä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ä¼ å…¥ Vue å®ä¾‹ä½œä¸º data é€‰é¡¹ï¼ŒVue å°†éå†æ­¤å¯¹è±¡æ‰€æœ‰çš„ propertyï¼Œå¹¶ä½¿ç”¨ Object.defineProperty æŠŠè¿™äº› property å…¨éƒ¨è½¬ä¸º getter&#x2F;setterã€‚è¿™äº› getter&#x2F;setter å¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œä½†æ˜¯åœ¨å†…éƒ¨å®ƒä»¬è®© Vue èƒ½å¤Ÿè¿½è¸ªä¾èµ–ï¼Œåœ¨ property è¢«è®¿é—®å’Œä¿®æ”¹æ—¶é€šçŸ¥å˜æ›´ã€‚</p>
<p>æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½å¯¹åº”ä¸€ä¸ª watcher å®ä¾‹ï¼Œå®ƒä¼šåœ¨ç»„ä»¶æ¸²æŸ“çš„è¿‡ç¨‹ä¸­æŠŠâ€œæ¥è§¦â€è¿‡çš„æ•°æ® property è®°å½•ä¸ºä¾èµ–ã€‚ä¹‹åå½“ä¾èµ–é¡¹çš„ setter è§¦å‘æ—¶ï¼Œä¼šé€šçŸ¥ watcherï¼Œä»è€Œä½¿å®ƒå…³è”çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</p>
<p><img src="https://cn.vuejs.org/images/data.png" alt="vue"></p>
<p>ä»¥ä¸Šå†…å®¹æ‘˜è‡ª vue æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ° vue2.x æ˜¯é€šè¿‡ Object.defineProperty å¯¹æ•°æ®è¿›è¡ŒåŒ…è£¹ï¼Œåœ¨é€šè¿‡å†…éƒ¨çš„è½¬æ¢å®ç°æ•°æ®çš„åŒå‘ç»‘å®šï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨ ui ç»„ä»¶(å¦‚ï¼šè¾“å…¥æ¡†)æ—¶å€™ï¼Œå¯ä»¥éå¸¸ä¾¿æ·çš„æ“ä½œæ•°æ®ã€‚é‚£ä¹ˆè¿™ä¸€å¥—æµç¨‹æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œè®©æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ª mini ç‰ˆæœ¬çš„ vue äº†è§£ä»–çš„æœ¬è´¨ã€‚</p>
<p>å®ç°æœ€ç»ˆä»£ç ï¼š <a target="_blank" rel="noopener" href="https://github1s.com/gzg1023/fackAchieve/tree/main/framework/vue">mini vue github åœ°å€</a></p>
<h2 id="æ¨¡æ‹Ÿå®ç°"><a href="#æ¨¡æ‹Ÿå®ç°" class="headerlink" title="æ¨¡æ‹Ÿå®ç°"></a>æ¨¡æ‹Ÿå®ç°</h2><p>æåˆ° vue å¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯å•å‘æ•°æ®æµå’Œæ•°æ®åŒå‘ç»‘å®šï¼Œä¹ä¸€çœ‹æœ‰ç‚¹å†²çªã€‚ä¸€ä¼šå„¿å•å‘ ä¸€ä¼šå„¿åŒå‘ï¼Œä½†æ˜¯å…¶å®ä¸ç„¶ï¼Œå•å‘æ•°æ®æµæ˜¯æŒ‡ç”¨æˆ·è®¿é—® Viewï¼ŒView å‘å‡ºç”¨æˆ·äº¤äº’çš„ Actionï¼Œåœ¨ Action é‡Œå¯¹ state è¿›è¡Œç›¸åº”æ›´æ–°ã€‚state æ›´æ–°åä¼šè§¦å‘ View æ›´æ–°é¡µé¢çš„è¿‡ç¨‹ã€‚è¿™æ ·æ•°æ®æ€»æ˜¯æ¸…æ™°çš„å•å‘è¿›è¡ŒæµåŠ¨ï¼Œä¾¿äºç»´æŠ¤å¹¶ä¸”å¯ä»¥é¢„æµ‹ã€‚ è€Œæ•°æ®åŒå‘ç»‘å®šæ˜¯åŸºäºå•å‘æ•°æ®æµä¹‹ä¸Šï¼ˆç†è§£ä¸ºä¸šåŠ¡å±‚ï¼‰çš„å®ç°ï¼Œé€šè¿‡ Model å’Œ View è¿›è¡Œç»‘å®šï¼Œä¿æŒä¸€è‡´çš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬ä»ç¬¬ä¸€æ­¥å¼€å§‹æ¨¡æ‹Ÿå®ç°ï¼Œåœ¨ä½¿ç”¨ vue æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡ new å…³é”®å­—åˆ›å»ºå®ä¾‹,é€šè¿‡ el æŒ‡å®šä¸€ä¸ª CSS é€‰æ‹©å™¨æˆ–è€…æ˜¯ä¸€ä¸ª DOM å¯¹è±¡ï¼Œç„¶ååœ¨ data éƒ¨åˆ†å®šä¹‰æˆ‘ä»¬è¦æ“ä½œçš„æ•°æ®ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†ã€‚ä½†æ˜¯è¿™èƒŒå vue åšäº†å¾ˆå¤šå·¥ä½œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œé€šè¿‡<code>new Vue</code>åˆ›å»ºäº† vm å®ä¾‹ï¼Œä¹Ÿæ˜¯æ•´ä¸ªæ¡†æ¶çš„å…¥å£ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;Hello Vue.js!&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡ es6 è¯­æ³• class çš„æ–¹å¼å®ç°æ•´ä¸ª mini vueï¼Œç”¨æ¥äº†è§£æ•´ä¸ªå“åº”å¼åŸç†çš„åŸºæœ¬ç»“æ„å’ŒåŸç†ã€‚</p>
<h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><p>åˆ›å»º Vue æ„é€ ç±»ï¼Œæˆ‘ä»¬å…ˆæ¥æ•´ç†ä¸€ä¸‹æµç¨‹</p>
<ol>
<li>åˆ›å»º vue å®ä¾‹ï¼Œä¼ å…¥ el é€‰é¡¹æ¥æŒ‡å®šæ¨¡ç‰ˆè¦æ›¿æ¢çš„å…ƒç´ </li>
<li>ä¼ å…¥å…¶ä»–é€‰é¡¹ dataï¼Œmethodsï¼Œcomputed ç­‰é€‰é¡¹æ¥ä½¿ç”¨ vue æä¾›çš„ api</li>
<li>æŠŠä¼ å…¥çš„ data å˜æˆå“åº”å¼æ•°æ®ï¼Œæ¿€æ´»æ•°æ®çš„åŒå‘ç»‘å®š</li>
<li>é€šè¿‡ v-dom å’Œ Compiler æŠŠ template ç¼–è¯‘æˆ render</li>
<li>é€šè¿‡ render è½¬ä¸º AST åœ¨è½¬ä¸º codeï¼Œå¹¶é€šè¿‡ v-dom çš„ diff æ¸²æŸ“é¡µé¢</li>
</ol>
<p>æˆ‘ä»¬æ¨¡æ‹Ÿçš„è¯ï¼Œå°±åªæ¶‰åŠå“åº”å¼åŸç†éƒ¨åˆ†ã€‚åªå¤„ç†ï¼ŒObserver å“åº”å¼ï¼ŒCompiler å¯¹ç®€å•æŒ‡ä»¤çš„è§£æ ä¸¤ä¸ªéƒ¨åˆ†çš„å®ç°ã€‚å…³äºå¼‚å¸¸å¤„ç†ï¼Œåœ¨æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œæ¶‰åŠï¼Œåœ¨ vue ä¸­å¯ä»¥çœ‹åˆ°åªè¦æ¶‰åŠåˆ°â€ç”¨æˆ·ä¼ å…¥â€éƒ¨åˆ†çš„å†…å®¹éƒ½æ·»åŠ äº†å¼‚å¸¸å¤„ç†å’Œ log å¼‚å¸¸æ—¥å¿—çš„è¾“å‡ºï¼Œè¿™ç‚¹åœ¨å¼€å‘åº“ç±»çš„é¡¹ç›®ä¸­å¾ˆå€¼å¾—å­¦ä¹ ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. é€šè¿‡å±æ€§ä¿å­˜é€‰é¡¹çš„æ•°æ®</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$options</span> = options || &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$data</span> = options.<span class="property">data</span> || &#123;&#125;;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å­—ç¬¦ä¸²å°±è¯´æ˜æ˜¯é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$el</span> =</span><br><span class="line">      <span class="keyword">typeof</span> options.<span class="property">el</span> === <span class="string">&quot;string&quot;</span></span><br><span class="line">        ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>)</span><br><span class="line">        : options.<span class="property">el</span>;</span><br><span class="line">    <span class="comment">// 2. æŠŠdataçš„æˆå‘˜è½¬åŒ–ä¸ºgetterå’Œsetteræ³¨å…¥åˆ°vueå®ä¾‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_proxyData</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">    <span class="comment">// 3. è°ƒç”¨observerå¯¹è±¡ï¼ŒæŠŠdataå±æ€§è½¬åŒ–ä¸ºå“åº”å¼æ•°æ®ï¼Œç›‘å¬æ•°æ®çš„å˜åŒ–</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">    <span class="comment">// 4. è°ƒç”¨Compilerå¯¹è±¡ï¼Œå¤„ç†æ¨¡ç‰ˆç¼–è¯‘</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Compiler</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_proxyData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†å¯¹è±¡</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data[key];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (newValue === data[key]) <span class="keyword">return</span>;</span><br><span class="line">          data[key] = newValue;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h3><p>æˆ‘ä»¬çŸ¥é“ Vue ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé‚£ä¹ˆå°±éœ€è¦è§‚å¯Ÿè€…å’Œå‘å¸ƒè€…æ¥å®Œæˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Dep å¯¹è±¡å†…éƒ¨åŒ…å«ä¸€ä¸ª subs æ•°ç»„ç”¨æ¥å­˜åœ¨æ‰€æœ‰çš„ä¾èµ–å¯¹è±¡ï¼Œé€šè¿‡ addSub æ–¹æ³•æ·»åŠ ä¾èµ–ï¼Œé€šè¿‡ notify æ–¹æ³•æ¥è§¦å‘æ‰€æœ‰ä»¥æ¥çš„æ›´æ–°ï¼ˆè°ƒç”¨ä¾èµ–çš„ update æ–¹æ³•ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§‚å¯Ÿè€…æ¨¡å¼çš„ å‘å¸ƒè€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–å¯¹è±¡</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ ä¾èµ–å¯¹è±¡</span></span><br><span class="line">  <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sub &amp;&amp; sub.<span class="property">update</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é€šçŸ¥æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sub</span>) =&gt;</span> &#123;</span><br><span class="line">      sub.<span class="title function_">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>Observer ç±»æœé›†ä¾èµ–ï¼Œåœ¨ get é˜¶æ®µæœé›†ä¾èµ–ï¼Œåœ¨ set é˜¶æ®µè§¦å‘ä¾èµ–çš„æ›´æ–°ã€‚å†…ç½®çš„ walk æ–¹æ³•å°±æ˜¯é€’å½’çš„å¤„ç†æ‰€æœ‰å¯¹è±¡ï¼Œæ·»åŠ ä¾èµ–å±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">targetData</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(targetData);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// éå†å¯¹è±¡æ‰€æœ‰å±æ€§</span></span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">targetData</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (!targetData || <span class="keyword">typeof</span> targetData !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰å±æ€§</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(targetData).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">defineReactive</span>(targetData, key, targetData[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰å“åº”å¼æ•°æ®</span></span><br><span class="line">  <span class="title function_">defineReactive</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–ï¼Œæ¥ç»Ÿä¸€æ›´æ–°</span></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span><br><span class="line">    <span class="comment">// è½¬åŒ–å¯¹è±¡çš„å†…éƒ¨å±æ€§</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(value);</span><br><span class="line">    <span class="keyword">const</span> _that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// ä¸è¿”å›obj[key]çš„åŸå› æ˜¯ä¼šé€’å½’è§¦å‘</span></span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue === value) <span class="keyword">return</span>;</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="comment">// å¤„ç†æ™®é€šå€¼è½¬ä¸ºå¯¹è±¡çš„æƒ…å†µ</span></span><br><span class="line">        _that.<span class="title function_">walk</span>(newValue);</span><br><span class="line">        <span class="comment">// å‘ç”Ÿé€šçŸ¥</span></span><br><span class="line">        dep.<span class="title function_">notify</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h3><p>æ¯ä¸€ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ª Watcher å¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ª update æ–¹æ³•ï¼Œä½œç”¨æ˜¯è°ƒç”¨ä¼ å…¥çš„ callback å‡½æ•°è¾¾åˆ°æ›´æ–°æ•°æ®çš„ç›®çš„ã€‚ä¹Ÿæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, key, cb</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb;</span><br><span class="line">    <span class="comment">// æŠŠwatcherå¯¹è±¡è®°å½•åˆ°Depç±»çš„é™æ€å±æ€§target</span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// è§¦å‘getæ–¹æ³•ï¼Œåœ¨getæ–¹æ³•ä¸­ä¼šè°ƒç”¨addSub</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldValue</span> = vm[key];</span><br><span class="line">    <span class="comment">// é‡åˆ¶ä¾èµ–å¯¹è±¡ï¼Œé˜²æ­¢æ•°æ®æ··ä¹±</span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="variable language_">this</span>.<span class="property">vm</span>[<span class="variable language_">this</span>.<span class="property">key</span>];</span><br><span class="line">    <span class="comment">// å¦‚æœæ•°æ®å‘ç°å˜åŒ–åˆ™æ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">oldValue</span> === newValue) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">cb</span>(newValue);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h3><p>Compiler æ˜¯å¤„ç†æ¨¡ç‰ˆç¼–è¯‘çš„å¯¹è±¡ï¼Œåœ¨ vue ä¸­å¤„ç† template å¯¹è±¡ç¼–è¯‘æˆ render å‡½æ•°å¹¶è§£ææŒ‡ä»¤ï¼Œå¤§æ‹¬å·è¯­æ³•ï¼Œç­‰ vue å†…ç½®å¯¹è±¡ã€‚æˆ‘ä»¬è¿™é‡Œåªé’ˆå¯¹ html æ¨¡ç‰ˆè¿›è¡Œç®€æŒ‡ä»¤çš„è§£æã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯é€’å½’çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“èŠ‚ç‚¹æœ‰å¤šå°‘å±‚ã€‚</p>
<p>åœ¨å¤„ç†å®ŒæˆæŒ‡ä»¤å’Œå¤§æ‹¬å·çš„è§£æåï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¯¹åº”çš„ data å€¼ ç„¶åé€šè¿‡ update æ–¹æ³•è¿›è¡Œæ›´æ–°ã€‚å…³äº v-model å°±æ˜¯é€šè¿‡è¡¨å•çš„ change äº‹ä»¶æ¥è¿›è¡ŒåŒå‘æ•°æ®çš„ç»‘å®šæ“ä½œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = vm.<span class="property">$el</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">compiler</span>(<span class="variable language_">this</span>.<span class="property">el</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¼–è¯‘æ¨¡ç‰ˆï¼Œå¤„ç†å„ç§èŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">compiler</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> childNodes = el.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="title function_">from</span>(childNodes).<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isTextNode</span>(node)) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ–‡æœ¬</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compilerText</span>(node);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isElementNode</span>(node)) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å…ƒç´ </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compilerElement</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¤„ç†å¤šå±‚èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compiler</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¼–è¯‘å…ƒç´ èŠ‚ç‚¹ï¼Œå¤„ç†æŒ‡ä»¤</span></span><br><span class="line">  <span class="title function_">compilerElement</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="title function_">from</span>(node.<span class="property">attributes</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">attr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> attrName = attr.<span class="property">name</span>;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡ä»¤</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isDirective</span>(attrName)) &#123;</span><br><span class="line">        <span class="comment">// è½¬åŒ–æŒ‡ä»¤</span></span><br><span class="line">        attrName = attrName.<span class="title function_">substr</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">let</span> key = attr.<span class="property">value</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update</span>(node, key, attrName);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¼–è¯‘æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¤„ç†å·®å€¼è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="title function_">compilerText</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+?)&#125;\&#125;/</span>;</span><br><span class="line">    <span class="keyword">let</span> content = node.<span class="property">textContent</span>;</span><br><span class="line">    <span class="keyword">if</span> (reg.<span class="title function_">test</span>(content)) &#123;</span><br><span class="line">      <span class="comment">// è·å–æ­£åˆ™åŒ¹é…çš„ç¬¬ä¸€ä¸ªå†…å®¹</span></span><br><span class="line">      <span class="keyword">let</span> key = <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="title function_">trim</span>();</span><br><span class="line">      node.<span class="property">textContent</span> = content.<span class="title function_">replace</span>(reg, <span class="variable language_">this</span>.<span class="property">vm</span>[key]);</span><br><span class="line">      <span class="comment">// è§¦å‘ä¾èµ–</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">        node.<span class="property">textContent</span> = newValue;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºæŒ‡ä»¤</span></span><br><span class="line">  <span class="title function_">isDirective</span>(<span class="params">attrName</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> attrName.<span class="title function_">startsWith</span>(<span class="string">&quot;v-&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">isTextNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºå…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">  <span class="title function_">isElementNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ›´æ–°æŒ‡ä»¤æ•°æ®</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">node, key, attrName</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> updateFn;</span><br><span class="line">    <span class="keyword">if</span> (attrName.<span class="title function_">indexOf</span>(<span class="string">&quot;:&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      attrName = attrName.<span class="title function_">substr</span>(<span class="number">3</span>);</span><br><span class="line">      updateFn = <span class="variable language_">this</span>.<span class="property">onUpdater</span>;</span><br><span class="line">      updateFn &amp;&amp; updateFn.<span class="title function_">call</span>(<span class="variable language_">this</span>, node, key, <span class="variable language_">this</span>.<span class="property">vm</span>[key], attrName);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      updateFn = <span class="variable language_">this</span>[attrName + <span class="string">&quot;Updater&quot;</span>];</span><br><span class="line">      <span class="comment">// æ­¤å¤„çš„thisçš„Compilerå¯¹è±¡</span></span><br><span class="line">      updateFn &amp;&amp; updateFn.<span class="title function_">call</span>(<span class="variable language_">this</span>, node, key, <span class="variable language_">this</span>.<span class="property">vm</span>[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤„ç†v-textæŒ‡ä»¤</span></span><br><span class="line">  <span class="title function_">textUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹çš„å€¼ç”¨textContent</span></span><br><span class="line">    node.<span class="property">textContent</span> = value;</span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">textContent</span> = newValue;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤„ç†v-modelæŒ‡ä»¤</span></span><br><span class="line">  <span class="title function_">modelUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// è¡¨å•çš„å€¼æ˜¯value</span></span><br><span class="line">    node.<span class="property">value</span> = value;</span><br><span class="line">    <span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">value</span> = newValue;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// åŒå‘ç»‘å®š</span></span><br><span class="line">    node.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">vm</span>[key] = node.<span class="property">value</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†v-show</span></span><br><span class="line">  <span class="title function_">showUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      node.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      node.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">style</span>.<span class="property">display</span> = newValue ? <span class="string">&quot;block&quot;</span> : <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤„ç†v-on</span></span><br><span class="line">  <span class="title function_">onUpdater</span>(<span class="params">node, key, value, handleType</span>) &#123;</span><br><span class="line">    <span class="comment">// value = value.substr(2)</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ğŸš€ onUpdater&quot;</span>, node, key, value);</span><br><span class="line">    node.<span class="title function_">addEventListener</span>(handleType, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">vm</span>[key]();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><p>æœ€åé€šè¿‡htmlæ–‡ä»¶åˆ›å»ºå®ä¾‹æ¥æµ‹è¯•mini vueã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>mini vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>å·®å€¼è¡¨è¾¾å¼<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">data-img</span>=<span class="string">&quot;http://google.com&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; person &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-text<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-model<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-if<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-show</span>=<span class="string">&quot;showFlag&quot;</span>&gt;</span>æµ‹è¯•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-on<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;clickHandle&quot;</span>&gt;</span>æµ‹è¯•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./dep.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./watcher.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./compiler.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./observer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">msg</span>:<span class="string">&#x27;hello mini vue&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">count</span>: <span class="number">200</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">showFlag</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">person</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">alex</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">age</span>:<span class="number">19</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">clickHandle</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">showFlag</span> = !<span class="variable language_">this</span>.<span class="property">showFlag</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>,<span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªvueè¿›è¡Œå“åº”å¼å¤„ç†çš„æµç¨‹æ˜¯ï¼šï¼ˆpatchæ–¹æ³•å°±æ˜¯v-domè¿›è¡Œdiffåæ›´æ–°ä¸ºçœŸå®é¡µé¢çš„æ“ä½œï¼‰</p>
<p>å“åº”å¼è§¦å‘<code>setter-&gt;Dep-&gt;Watcher-&gt;update-&gt;patch</code>ã€‚</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/04/01/2021/observer/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-11-14 00:10:05
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/%E5%89%8D%E7%AB%AF/" title="å‰ç«¯">
                        #å‰ç«¯
                      </a>
                    </span>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/vue%E5%8E%9F%E7%90%86/" title="vueåŸç†">
                        #vueåŸç†
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2021/04/24/2021/vue_principle_02/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-text">å¼•è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ¨¡æ‹Ÿå®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue"><span class="toc-text">Vue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dep"><span class="toc-text">Dep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Observer"><span class="toc-text">Observer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Watcher"><span class="toc-text">Watcher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compiler"><span class="toc-text">Compiler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index-html"><span class="toc-text">index.html</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/gzg1023">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright Â© 2025 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        


        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
